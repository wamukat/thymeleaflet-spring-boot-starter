<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<!--
/**
 * 使用例パネルフラグメント
 *
 * 右ペインの使用例カードを提供する。
 *
 * @example <div th:replace="~{thymeleaflet/fragments/usage-panel :: panel()}"></div>
 */
-->
<div th:fragment="panel" class="card-thymeleaflet">
    <div class="card-thymeleaflet-header">
        <h3 class="text-lg font-semibold text-gray-900">
            <span th:text="#{thymeleaflet.usage.title}">Usage Example</span>
            <span th:if="${selectedStory}" class="text-gray-500 font-normal" th:text="'- ' + ${selectedStory.displayTitle ?: selectedStory.storyName}">- Default</span>
        </h3>
    </div>
    <div class="card-thymeleaflet-content">
        <div th:if="${displayModel != null and !#maps.isEmpty(displayModel)}" class="mb-3 text-xs text-gray-500">
            <span th:text="#{thymeleaflet.storyPreview.model.description}">
                Model values are injected via story.model.
            </span>
        </div>
        <div th:if="${selectedFragment != null and selectedStory != null}"
             hx-get th:hx-get="@{'/thymeleaflet/' + ${templatePathEncoded} + '/' + ${selectedFragment.fragmentName} + '/' + ${selectedStory.storyName} + '/usage'}"
             hx-trigger="load"
             hx-swap="innerHTML">
            <!-- HTMXでロードされる使用例 -->
        </div>

        <!-- 統一コピーボタンコンポーネント使用 -->
        <button class="mt-4 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm rounded-lg font-medium transition-colors"
                onclick="copyUsageExample('usage-example')">
            <span th:text="#{thymeleaflet.usage.copy}">Copy usage</span>
        </button>
    </div>
</div>

<!--
/**
 * Fragment list 用の使用例パネル
 *
 * @fragment fragmentList
 */
-->
<div th:fragment="fragmentList" class="card-thymeleaflet">
    <div class="card-thymeleaflet-header">
        <h3 class="text-lg font-semibold text-gray-900" th:text="#{thymeleaflet.usage.title}">Usage Example</h3>
        <span th:if="${selectedStory != null}" class="text-sm text-gray-500 ml-2"
              th:text="'- ' + (${selectedStory.displayTitle != null ? selectedStory.displayTitle : (selectedStory.storyName != null ? selectedStory.storyName : #{thymeleaflet.story.default})})"></span>
    </div>
    <div class="card-thymeleaflet-content">
        <div class="storybook-usage-example">
            <div th:if="${selectedFragment != null}">
                <div th:if="${selectedStory != null}"
                     th:hx-get="@{/thymeleaflet/{templatePath}/{fragmentName}/{storyName}/usage(templatePath=${templatePathEncoded}, fragmentName=${selectedFragment.fragmentName}, storyName=${selectedStory.storyName})}"
                     hx-trigger="load"
                     hx-swap="innerHTML">
                    <!-- HTMXでロードされる使用例 -->
                </div>
                <div th:if="${selectedStory == null}"
                     class="text-sm text-gray-500">
                    <span th:text="#{thymeleaflet.preview.selectStory}">Select a story to preview</span>
                </div>
            </div>
        </div>
        <button class="mt-3 btn-thymeleaflet-secondary btn-thymeleaflet-small" @click="copyUsageExample()"
                th:text="#{thymeleaflet.usage.copy}">
            Copy usage
        </button>
    </div>
</div>

<!--
/**
 * Story preview 用の使用例パネル
 *
 * @fragment storyPreview
 */
-->
<div th:fragment="storyPreview" class="card-thymeleaflet">
    <div class="card-thymeleaflet-header">
        <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-900" th:text="#{thymeleaflet.usage.title}">Usage Example</h3>
            <div class="flex items-center space-x-2">
                <span id="usage-status" class="text-xs text-gray-500"
                      th:text="#{thymeleaflet.storyPreview.usage.syncing}">
                    Syncing with preview...
                </span>
                <div id="usage-indicator" class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>
            </div>
        </div>
    </div>
    <div class="card-thymeleaflet-content">
        <div id="usage-description" class="mb-3 text-sm text-gray-600"
             th:text="#{thymeleaflet.storyPreview.usage.description}">
            This usage example reflects the current preview.
        </div>
        <div th:if="${displayModel != null and !displayModel.isEmpty()}" class="mb-3 text-xs text-gray-500">
            <span th:text="#{thymeleaflet.storyPreview.model.description}">
                Model values are injected via story.model.
            </span>
        </div>
        <div class="bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-sm overflow-x-auto">
            <div id="usage-example"
                 th:hx-get="@{/thymeleaflet/{templatePath}/{fragmentName}/{storyName}/usage(templatePath=${templatePathEncoded}, fragmentName=${storyInfo.fragmentInfo.fragmentName}, storyName=${storyInfo.storyName})}"
                 hx-trigger="load delay:500ms"
                 hx-target="this"
                 hx-swap="outerHTML">
                <pre><code class="language-html hljs"><!-- [[#{thymeleaflet.storyPreview.usage.loading}]] --></code></pre>
            </div>
        </div>
        <!-- 統一コピーボタンコンポーネント使用 -->
        <button class="mt-3 btn-thymeleaflet-secondary btn-thymeleaflet-small" onclick="copyUsageExample('usage-example')">
            <span th:text="#{thymeleaflet.usage.copy}">Copy usage</span>
        </button>
    </div>
</div>

</body>
</html>
